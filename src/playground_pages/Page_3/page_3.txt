<template>
    <Page>
        <ActionBar title="Home" />

        <StackLayout class="home-panel">
            <Label :text="medi_type" height="50"
                horizontalAlignment="center" />
            <Label :text="animal_type" height="50"
                horizontalAlignment="center" />
            <TextField class="weigth_entry" width="70%" keyboardType="number"
                v-model="textFieldValue" hint="Gewicht eingeben"
                @returnPress="on_weight_enter" />
            <Button text="Eingabe" @tap="on_weight_enter" />

            <ListView for="option in options" @itemTap="onItemTap"
                style="height:50%">
                <v-template>
                    <Label :text="option" style="width: 90%"
                        backgroundColor="red" />
                </v-template>
            </ListView>
            <Label text="zu verabreichende Menge" />
            <Label :text="result" />

        </StackLayout>

    </Page>
</template>




<script>
    export default {
        methods: {
            onItemTap: function(args) {
                console.log("Item with index: " + args.index + " tapped");
                //auslagern in extrafunktion
                let w = parseFloat(this.animal_weight);
                let r =
                    this.med_data[this.medi_type][this.animal_type][
                        "Menge_pro_kg"
                    ][
                        args.index
                    ] * w;
                console.log(r.toFixed(2));
                this.result = r.toFixed(2);
                //TODO change backgroundcolor of item

            },

            on_weight_enter() {
                console.log("weight entered");
                if (this.textFieldValue === "") return;
                this.animal_weight = this.textFieldValue;
                this.textFieldValue = "";
                this.options = this.med_data[this.medi_type][this.animal_type]
                    [
                        "Behandlungsoptionen"
                    ];
                //console.log(this.med_data[this.medi_type][this.animal_type]["Behandlungsoptionen"][0]);
            }
        },

        data() {
            return {
                med_data: {
                    Metacam: {
                        Rind: {
                            Behandlungsoptionen: [
                                "iv",
                                "im",
                                "Teleportation in die Zelle"
                            ],
                            Menge_pro_kg: [10.0, 12.0, 4.0]
                        }
                    }
                },
                textFieldValue: "",
                animal_weight: "",
                result: "",
                animal_type: "Rind", //wird von den Screens vorher gesetzt
                medi_type: "Metacam", //wird von den Screens vorher gesetzt
                options: []
            };
        }
    };
</script>

<style scoped>
    .home-panel {

        font-size: 20;
        margin: 15;
    }

    .description-label {
        margin-bottom: 15;
    }
</style>